name: wp-headless
services:
  app:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      args:
        NEXT_PUBLIC_WORDPRESS_URL: https://wp.insightful.design
        NEXT_PUBLIC_GRAPHQL_ENDPOINT: https://wp.insightful.design/graphql
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_WORDPRESS_URL=https://wp.insightful.design
      - NEXT_PUBLIC_GRAPHQL_ENDPOINT=https://wp.insightful.design/graphql
      - REDIS_URL=redis://redis:6379
      - ISR_REVALIDATE_SECONDS=300
      - REVALIDATE_SECRET=hXk9mR4vLpQ2wNcJ7fTbYs
    ports:
      - "3000:3000"
    depends_on:
      redis:
        condition: service_started

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      - redis_data:/data

volumes:
  redis_data:
